
<view:>
    <div class="blockquote">
        <h2>{{@model.name}}
            <button class="btn btn-default" on-click="startVoting(@model)">
                <span class="glyphicon glyphicon-print"/>
            </button>
            {{if !model.dateFinished && _session.userId==@model.owner}}
                {{if @model.dateStarted}}
                <button class="btn btn-danger" on-click="stopVoting(@model)">
                    <span class="glyphicon glyphicon-stop"/> Остановить
                </button>
                {{else if @model.candidats.length>2 && Object.keys(@model.participants).length && @model.owner === _session.userId}}
                <button class="btn btn-info" on-click="startVoting(@model)">
                    <span class="glyphicon glyphicon-play"/> Старт!
                </button>
                {{/}}
            {{/}}
        </h2>

    </div>

    <dl class="dl-horizontal ">
        <dt>Создано:</dt>
        <dd>{{formatDate(@model.timeCreated)}}</dd>
        <dt>Менеджер:</dt>
        <dd>
            {{with getUser(@model.owner)}}
                <a href="/users/id">{{this.name}}</a>
                {{if @model.owner === _session.userId}}
                    (Вы)
                {{/}}
            {{/}}
        </dd>
    </dl>
    <p>{{@model.description}}</p>
    <hr>
    {{if @model.dateStarted}}
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: {{_page.progress}}%">
            {{_page.progress}}% Проголосовало
        </div>
    </div>
    {{/}}
    <h4>
        Кандидаты
        {{if @model.owner==_session.userId}}
        <button type="button" class="btn btn-default" on-click="table.switchEditMode()">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
        {{/}}
        {{if @model.timeFinish}}
        <button type="button" class="btn btn-default" on-click="viewResults()">
            <span class="glyphicon glyphicon-pencil"/> Результаты
        </button>
        {{/}}
    </h4>
    <p>
        {{if @model.owner==_session.userId}}
        влвделец
            {{if tableMode=='results'}}
            <view name="results" table = "{{_page.view.results}}"/>
            {{else}}
            <view name="table" as="table" table = "{{_page.view.candidats}}"/>
            {{/}}
        {{else if @model.participants[_session.userId].role == 1}}
       эксперт
        <view name="table:vote" table = "{{_page.view.candidats}}" vote="{{_page.view.participants[_session.userId].vote}}"/>
        {{else if @model.participants[_session.userId].role == 0}}
            наблюдатель
            <view name="table:readonly" table = "{{_page.view.candidats}}"/>
        {{/}}

    </p>

<results:>
    Резултатты голосования


<new:>
    <form role="form">
        <h3>Новое голосование</h3>

            <div class="form-group">
                <input name="name" type="text" class="form-control" placeholder="Название" value="{{_page.new.name}}" required autofocus>
            </div>
            <div class="form-group">
                <textarea class="form-control" placeholder="Описание"  rows="3">{{_page.new.description}}</textarea>
            </div>

        <view name="table" table = {{_page.new.candidats}}></view>


        <mode-controls></mode-controls>
    </form>






